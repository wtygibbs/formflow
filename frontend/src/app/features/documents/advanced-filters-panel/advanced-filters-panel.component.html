<div class="h-full flex flex-col bg-background">
  <!-- Header -->
  <div class="flex items-center justify-between p-6 border-b">
    <h2 class="text-xl font-semibold">Advanced Filters</h2>
    <button hlmBtn variant="ghost" size="sm" (click)="closePanel()">
      ✕
    </button>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto p-6 space-y-6">
    <!-- Filter Presets -->
    <div>
      <h3 class="text-sm font-medium mb-3">Filter Presets</h3>
      <div class="space-y-2">
        @for (preset of allPresets(); track preset.id) {
          <div class="flex items-center gap-2">
            <button
              hlmBtn
              [variant]="selectedPreset() === preset.id ? 'default' : 'outline'"
              size="sm"
              class="flex-1 justify-start"
              (click)="loadPreset(preset.id)"
            >
              {{ preset.name }}
            </button>
            @if (preset.id.startsWith('custom-')) {
              <button
                hlmBtn
                variant="ghost"
                size="sm"
                (click)="deletePreset(preset.id)"
                title="Delete preset"
              >
                🗑️
              </button>
            }
          </div>
        }
      </div>
    </div>

    <div class="border-t pt-4"></div>

    <!-- Date Range -->
    <div>
      <label class="text-sm font-medium mb-2 block">Date Range</label>
      <brn-select [ngModel]="filters().dateRange" (ngModelChange)="onDateRangeChange($event)">
        <hlm-select-trigger class="w-full">
          <hlm-select-value />
        </hlm-select-trigger>
        <hlm-select-content>
          <hlm-option value="all">All Time</hlm-option>
          <hlm-option value="last7">Last 7 Days</hlm-option>
          <hlm-option value="last30">Last 30 Days</hlm-option>
          <hlm-option value="last90">Last 90 Days</hlm-option>
          <hlm-option value="custom">Custom Range</hlm-option>
        </hlm-select-content>
      </brn-select>

      @if (filters().dateRange === 'custom') {
        <div class="mt-3 space-y-2">
          <div>
            <label class="text-xs text-muted-foreground">Start Date</label>
            <input
              hlmInput
              type="date"
              [(ngModel)]="filters().customStartDate"
              class="w-full mt-1"
            />
          </div>
          <div>
            <label class="text-xs text-muted-foreground">End Date</label>
            <input
              hlmInput
              type="date"
              [(ngModel)]="filters().customEndDate"
              class="w-full mt-1"
            />
          </div>
        </div>
      }
    </div>

    <!-- Confidence Score -->
    <div>
      <label class="text-sm font-medium mb-2 block">
        Min Confidence Score: {{ filters().minConfidence }}%
      </label>
      <input
        type="range"
        min="0"
        max="100"
        [value]="filters().minConfidence"
        (input)="onConfidenceChange($any($event.target).value)"
        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
      />
      <div class="flex justify-between text-xs text-muted-foreground mt-1">
        <span>0%</span>
        <span>50%</span>
        <span>100%</span>
      </div>
    </div>

    <!-- File Type -->
    <div>
      <label class="text-sm font-medium mb-2 block">File Types</label>
      <div class="flex flex-wrap gap-2">
        @for (type of availableFileTypes; track type.value) {
          <button
            hlmBtn
            [variant]="isFileTypeSelected(type.value) ? 'default' : 'outline'"
            size="sm"
            (click)="toggleFileType(type.value)"
          >
            {{ type.label }}
          </button>
        }
      </div>
    </div>

    <!-- Field Count Range -->
    <div>
      <label class="text-sm font-medium mb-2 block">Field Count</label>
      <div class="grid grid-cols-2 gap-2">
        <div>
          <label class="text-xs text-muted-foreground">Min</label>
          <input
            hlmInput
            type="number"
            [(ngModel)]="filters().minFieldCount"
            placeholder="No min"
            class="w-full mt-1"
            min="0"
          />
        </div>
        <div>
          <label class="text-xs text-muted-foreground">Max</label>
          <input
            hlmInput
            type="number"
            [(ngModel)]="filters().maxFieldCount"
            placeholder="No max"
            class="w-full mt-1"
            min="0"
          />
        </div>
      </div>
    </div>

    <!-- Active Filters Badge -->
    @if (hasActiveFilters()) {
      <div class="bg-primary/10 p-3 rounded-md">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-medium">Active Filters</span>
          <span hlmBadge>{{ hasActiveFilters() ? 'Filtering' : 'None' }}</span>
        </div>
        <div class="flex flex-wrap gap-2">
          @if (filters().dateRange !== 'all') {
            <span hlmBadge variant="secondary">📅 {{ filters().dateRange }}</span>
          }
          @if (filters().minConfidence > 0) {
            <span hlmBadge variant="secondary">📊 ≥{{ filters().minConfidence }}%</span>
          }
          @if (filters().fileTypes.length > 0) {
            <span hlmBadge variant="secondary">📄 {{ filters().fileTypes.join(', ') }}</span>
          }
          @if (filters().minFieldCount !== undefined || filters().maxFieldCount !== undefined) {
            <span hlmBadge variant="secondary">🔢 Fields</span>
          }
        </div>
      </div>
    }
  </div>

  <!-- Footer Actions -->
  <div class="border-t p-4 space-y-2">
    <div class="flex gap-2">
      <button hlmBtn class="flex-1" (click)="applyFilters()">
        Apply Filters
      </button>
      <button hlmBtn variant="outline" (click)="clearFilters()">
        Clear
      </button>
    </div>
    <button hlmBtn variant="secondary" class="w-full" (click)="saveAsPreset()">
      💾 Save as Preset
    </button>
  </div>
</div>
